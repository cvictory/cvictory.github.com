## Dubbo 2.7.4.1的那些故事

### 发生事故

dubbo-2.7.4版本第二轮投票结束之后，有同学反馈发布的版本有问题，经过验证之后，发现真的出现了严重的低级bug，但是版本已经release了。发布过的maven仓库release jar包的同学都清楚，release版本一经发布，原则上是不允许修改和删除的。如果要删除，需要发邮件申请，流程非常复杂。

### 怎么处理

出现了上面的问题之后，要怎么解决呢？

遇到上面的问题，和发布项目遇到问题，有很多相似的地方。一般来说会按照以下步骤：

1.保留现场，并止血。保留现场很重要，如快速dump内存，保留日志。止血通过快速回滚或者将开关切回老流程。对核心功能的改造，往往会加上开关，进行新老流程的切换。

2.如果涉及面非常广，还要及时发公告。

3.分析问题，产出可行的解决方案。

4.根据可行的解决方案，看是否现在实施。如果实施完毕，需要通知被影响方。

5.复盘

而dubbo-2.7.4发版遇到问题之后，我们复现了原因，确定了问题，决定发布bug fix版本：2.7.4.1。所以当天就开始修复，并且在第二天发起了dubbo-2.7.4.1的投票。

### 回顾过程

复盘下dubbo-2.7.4的发版过程，dubbo已经捐献给apache，所以dubbo的发版需要按照apache的方式进行。发版过程可以参考[发布向导](http://dubbo.apache.org/zh-cn/docs/developers/committer-guide/release-guide_dev.html).

#### 代码冻结和集成测试验证

每次发布版本的时候，都会先拉出一个新的分支，进行冻结代码。冻结代码之后，会跑[dubbo-sample](https://github.com/apache/dubbo-samples)的集成测试，验证基本功能是否完整。

#### 发起第一轮投票

这次发起发版本的时候，导师发现有些代码的license不对，部分代码来自 [spring-context-support](https://github.com/alibaba/spring-context-support) 的代码拷贝和修改。然后开始了漫长的沟通和修改方法讨论。

1. 修改了spring-context-support的license，修改为apache 2.0 license。这种修改还是不行。
2. 重写dubbo引用spring-context-support的代码。还是不行，因为拷贝和修改的类文件有多个，完全改完，有点困难。
3. spring-context-support是属于alibaba的，让alibaba开源负责人签名授权。最终搞定了。

#### 打回修改

经过这几轮修改，决定重新发起投票。但是在这个过程中，刚好和瓜子的同学有沟通，瓜子的同学期望社区修复zookeeper假死问题的修复。这个过程，就有同学开始了修复，然后提交了PR。

#### 发起第二轮投票

整个周期已经过了接近2周，所以没有进行集成测试回归，而快速发起第二轮投票。第二轮投票也不负众望，快速投票通过。投票通过之后，就将对应的包发布到了中央仓库。然后就收到了同学邮件反馈出现了问题。

### 总结

每次发布版本，无论修改多么少，在发布之前，一定要做好集成测试用例的回归。

需求的控制，release manager一定要严格把控需求。在冻结代码之后，新进来的pr一定要重点审查。

这是我的锅！！！

## 项目管理的那些事儿

项目管理上遵循一定的方法论，可以避免常见的一些问题。项目管理涉及的范围非常广，可以说任何和项目有关的东西，都可以纳入进项目进行管理。比如某人失恋了，也可能会影响项目的进度，要做好风险管理。常见的一些项目管理分享，可能会包含需求管理，风险管理，会议管理，时间管理等等。

和本体比较有关的有几个点：

#### 需求管理

开源项目有多重形式，像spring这样的公司，属于相对封闭的，spring社区允许你提issue和pr，但是不会往外下发committer权限，所以公司对spring代码拥有觉得的控制。而像apache的开源项目，期望社区拥有足够多的PMC和committer，所以需求范围以及版本的稳定性，对开源产品本身具有很大的挑战。

这种方式，就需要一个release manager提前介入，在发版时间点之前，需要收集一些关键的issue，号召社区的同学一起来修复；同时需要时刻关注pr的情况，以便控制需求的范围。所以dubbo每个版本的需求，是有一个模糊的边界，要让边界更加明确，依赖于release manager。 这点和普通的业务项目是不一样的。

#### 流程管理

需要真正遵循的流程很多：

假如你是issue提交者，能否在描述问题的时候描述足够清楚的同时，上传一个Demo能够复现问题。这样对于跟踪问题的同学是莫大的恩赐。

假如你是PR提交者，你在提交PR前，是否能保证足够的单元测试用例，部分复杂逻辑是否加上一些注释。(规约)

假如你是committer和PMC，你在处理PR的时候，能否启动一个Demo去验证。

假如你是Release Manager，你是否可以理清issue和pr，你能够保证足够多的集成测试去保证这次发布的基本流程。

只要人人多做一点，社会会更加幸福美满。一味索取，而不知道付出，是很难有快速的成长的。

#### 风险管理

Release Manager在整理issue和pr过程中，可以及时进行一些风险点梳理。

同时对于一些较大功能迭代的版本，更加需要风险和质量的管理。

## Dubbo release manager需要做对哪些事

了解发布流程，熟悉apache的工作方式，同时做好一些基础的项目管理。

Dubbo是开源项目，所以需要大家共同的呵护。期望更多有志青年的加入，多去社区看下issue，尝试着去解决。只要足够的付出，以除了成为dubbo commiter之外，一定会有其他意想不到的收货。



